# ЁЯФР bcrypt & jsonwebtoken

> р╕Др╕╣р╣Ир╕бр╕╖р╕нр╕вр╣Ир╕нр╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╣Ар╕Вр╣Йр╕▓р╕гр╕лр╕▒р╕кр╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ р╣Бр╕ер╕░р╕кр╕гр╣Йр╕▓р╕З/р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ JSON Web Token
> (JWT)

---

## ЁЯзй bcrypt

`bcrypt` р╣Гр╕Кр╣Йр╕кр╕│р╕лр╕гр╕▒р╕Ъ **р╣Ар╕Вр╣Йр╕▓р╕гр╕лр╕▒р╕кр╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ (password hashing)**
р╣Ар╕Юр╕╖р╣Ир╕нр╕Др╕зр╕▓р╕бр╕Ыр╕ер╕нр╕Фр╕ар╕▒р╕вр╕Вр╕нр╕Зр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й

---

### ЁЯУШ Syntax 1 --- р╣Бр╕Ър╕Ъ Promise

```js
bcrypt.hash(text, salt): Promise<string>
```

**р╕Юр╕▓р╕гр╕▓р╕бр╕┤р╣Ар╕Хр╕нр╕гр╣М**\

- `text` : р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╣Ар╕Вр╣Йр╕▓р╕гр╕лр╕▒р╕к (р╣Ар╕Кр╣Ир╕Щ р╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ)\
- `salt` : р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕кр╕╕р╣Ир╕бр╕Чр╕╡р╣Ир╣Гр╕Кр╣Йр╣Гр╕Щр╕Бр╕гр╕░р╕Ър╕зр╕Щр╕Бр╕▓р╕гр╣Ар╕Вр╣Йр╕▓р╕гр╕лр╕▒р╕к
  р╣Ар╕Юр╕╖р╣Ир╕нр╕Ыр╣Йр╕нр╕Зр╕Бр╕▒р╕Щр╕Бр╕▓р╕гр╣Ар╕Фр╕▓р╕гр╕лр╕▒р╕кр╕Лр╣Йр╕│\
- **р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М** : р╕Др╕╖р╕Щр╕Др╣Ир╕▓р╣Ар╕Ыр╣Зр╕Щ **Promise**\
- р╕лр╕▓р╕Бр╕кр╕│р╣Ар╕гр╣Зр╕И тЖТ р╣Др╕Фр╣Йр╕Др╣Ир╕▓ hash (string)\
- р╕лр╕▓р╕Бр╕ер╣Йр╕бр╣Ар╕лр╕ер╕з тЖТ р╕Др╕╖р╕Щ error

**р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕З**

```js
bcrypt
  .hash('mypassword', 10)
  .then(hash => console.log(hash))
  .catch(err => console.log(err));
```

---

### ЁЯУШ Syntax 2 --- р╣Бр╕Ър╕Ъ Callback

```js
bcrypt.hash(text, salt, callback(err, hash));
```

**р╕Юр╕▓р╕гр╕▓р╕бр╕┤р╣Ар╕Хр╕нр╕гр╣М**\

- `text` : р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Чр╕╡р╣Ир╕Ир╕░р╣Ар╕Вр╣Йр╕▓р╕гр╕лр╕▒р╕к\
- `salt` : р╕Ир╕│р╕Щр╕зр╕Щр╕гр╕нр╕Ър╕Бр╕▓р╕гр╕кр╕╕р╣Ир╕б (р╣Ар╕Кр╣Ир╕Щ 10)\
- `callback(err, hash)` : р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕Чр╕╡р╣Ир╕Ир╕░р╕Цр╕╣р╕Бр╣Ар╕гр╕╡р╕вр╕Бр╕лр╕ер╕▒р╕Зр╕Бр╕▓р╕гр╣Ар╕Вр╣Йр╕▓р╕гр╕лр╕▒р╕кр╣Ар╕кр╕гр╣Зр╕И\
- `err` тЖТ error р╕Цр╣Йр╕▓р╕бр╕╡р╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Ф\
- `hash` тЖТ р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Чр╕╡р╣Ир╣Ар╕Вр╣Йр╕▓р╕гр╕лр╕▒р╕кр╣Ар╕кр╕гр╣Зр╕Ир╣Бр╕ер╣Йр╕з

**р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕З**

```js
bcrypt.hash('mypassword', 10, (err, hash) => {
  if (err) console.log(err);
  else console.log(hash);
});
```

---

## ЁЯкк jsonwebtoken (JWT)

`jsonwebtoken` р╣Гр╕Кр╣Йр╣Гр╕Щр╕Бр╕▓р╕г **р╕кр╕гр╣Йр╕▓р╕Зр╣Бр╕ер╕░р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Вр╕Чр╣Ар╕Др╕Щ (Token)**
р╕кр╕│р╕лр╕гр╕▒р╕Ър╕гр╕░р╕Ър╕Ър╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕Хр╕▒р╕зр╕Хр╕Щр╕Вр╕нр╕Зр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й

---

### тЬи Create JWT

**Syntax**

```js
jwt.sign(payload, key, option): string
```

**р╕Др╕│р╕нр╕Шр╕┤р╕Ър╕▓р╕в** \| р╕Юр╕▓р╕гр╕▓р╕бр╕┤р╣Ар╕Хр╕нр╕гр╣М \| р╕Др╕зр╕▓р╕бр╕лр╕бр╕▓р╕в \|
\|---------------\|-----------\| \| `payload` \| р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕╡р╣Ир╕Ир╕░р╕Эр╕▒р╕Зр╣Гр╕Щ token
р╣Ар╕Кр╣Ир╕Щ user id, username, role р╕пр╕ер╕п \| \| `key` \| р╕Бр╕╕р╕Нр╣Бр╕Ир╕ер╕▒р╕Ър╕Чр╕╡р╣Ир╣Гр╕Кр╣Йр╣Ар╕Лр╣Зр╕Щ token
(р╕Хр╣Йр╕нр╕Зр╕Хр╕гр╕Зр╕Бр╕▒р╕Ър╕Эр╕▒р╣Ир╕З verify) \| \| `option` \| р╕Хр╕▒р╕зр╣Ар╕ер╕╖р╕нр╕Бр╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕┤р╕б р╣Ар╕Кр╣Ир╕Щ р╕нр╕▓р╕вр╕╕р╕Вр╕нр╕З
token, algorithm \|

**р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕З**

```js
const token = jwt.sign({ username: 'tum', role: 'teacher' }, 'MY_SECRET_KEY', {
  expiresIn: '1h',
});
console.log(token);
```

---

### ЁЯза р╕кр╣Ир╕зр╕Щр╕Ыр╕гр╕░р╕Бр╕нр╕Ър╕Вр╕нр╕З Token

р╣Вр╕Чр╣Ар╕Др╕Щр╕бр╕╡ 3 р╕кр╣Ир╕зр╕Щ р╕Др╕▒р╣Ир╕Щр╕Фр╣Йр╕зр╕вр╕Ир╕╕р╕Ф (`.`)

    xxxxx.yyyyy.zzzzz

---

р╕кр╣Ир╕зр╕Щ р╕Кр╕╖р╣Ир╕нр╣Ар╕Хр╣Зр╕б р╕Др╕зр╕▓р╕бр╕лр╕бр╕▓р╕в

---

ЁЯЯе `Header` р╕кр╣Ир╕зр╕Щр╕лр╕▒р╕з р╕гр╕░р╕Ър╕╕р╕нр╕▒р╕ер╕Бр╕нр╕гр╕┤р╕Чр╕╢р╕бр╕Чр╕╡р╣Ир╣Гр╕Кр╣Йр╣Ар╕Вр╣Йр╕▓р╕гр╕лр╕▒р╕к
р╣Ар╕Кр╣Ир╕Щ HS256

ЁЯЯз `Payload` р╣Ар╕Щр╕╖р╣Йр╕нр╕лр╕▓ р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕╡р╣Ир╕Эр╕▒р╕Зр╣Гр╕Щ token р╣Ар╕Кр╣Ир╕Щ
username, role

ЁЯЯй `Signature` р╕ер╕▓р╕вр╣Ар╕Лр╣Зр╕Щ р╣Гр╕Кр╣Йр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Др╕бр╣Ир╕Цр╕╣р╕Бр╣Бр╕Бр╣Йр╣Др╕В
(р╣Ар╕Вр╣Йр╕▓р╕гр╕лр╕▒р╕кр╕Фр╣Йр╕зр╕в key)

---

> ЁЯФН р╕кр╕▓р╕бр╕▓р╕гр╕Цр╕ер╕нр╕Зр╕Цр╕нр╕Фр╕гр╕лр╕▒р╕к token р╣Др╕Фр╣Йр╕Чр╕╡р╣И <https://jwt.io>

---

## тЬЕ Verify JWT

**Syntax**

```js
jwt.verify(token, key, option): string | Object
```

**р╕Др╕│р╕нр╕Шр╕┤р╕Ър╕▓р╕в** \| р╕Юр╕▓р╕гр╕▓р╕бр╕┤р╣Ар╕Хр╕нр╕гр╣М \| р╕Др╕зр╕▓р╕бр╕лр╕бр╕▓р╕в \|
\|---------------\|-----------\| \| `token` \| р╣Вр╕Чр╣Ар╕Др╕Щр╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ \|
\| `key` \| р╕Бр╕╕р╕Нр╣Бр╕Ир╕ер╕▒р╕Ъ (р╕Хр╣Йр╕нр╕Зр╕Хр╕гр╕Зр╕Бр╕▒р╕Ър╕Хр╕нр╕Щр╕кр╕гр╣Йр╕▓р╕З token) \| \| `option` \|
р╕Хр╕▒р╕зр╣Ар╕ер╕╖р╕нр╕Бр╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕┤р╕б р╣Ар╕Кр╣Ир╕Щ `{ algorithms: ['HS256'] }` \|

**р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М**\

- р╕Цр╣Йр╕▓ token р╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З тЖТ р╕Др╕╖р╕Щр╕Др╣Ир╕▓р╣Ар╕Ыр╣Зр╕Щ **Object (payload)**\
- р╕Цр╣Йр╕▓ token р╕лр╕бр╕Фр╕нр╕▓р╕вр╕╕р╕лр╕гр╕╖р╕нр╣Др╕бр╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З тЖТ р╕Ир╕░р╣Ар╕Бр╕┤р╕Ф error

**р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕З**

```js
try {
  const decoded = jwt.verify(token, 'MY_SECRET_KEY');
  console.log('тЬЕ Token р╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З:', decoded);
} catch (err) {
  console.log('тЭМ Token р╣Др╕бр╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З:', err.message);
}
```

---

## ЁЯУШ р╕кр╕гр╕╕р╕Ыр╕ар╕▓р╕Юр╕гр╕зр╕б

р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щ р╕лр╕Щр╣Йр╕▓р╕Чр╕╡р╣И р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М

---

`bcrypt.hash()` р╣Ар╕Вр╣Йр╕▓р╕гр╕лр╕▒р╕кр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б Hash р╕Чр╕╡р╣Ир╣Др╕бр╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╕Цр╕нр╕Фр╕Бр╕ер╕▒р╕Ър╣Др╕Фр╣Й
`jwt.sign()` р╕кр╕гр╣Йр╕▓р╕З Token String (JWT Token)
`jwt.verify()` р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Token Object (payload) р╕лр╕гр╕╖р╕н Error

---

## ЁЯТб р╣Ар╕Др╕ер╣Зр╕Фр╕ер╕▒р╕Ър╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕┤р╕б

- р╕нр╕вр╣Ир╕▓р╣Ар╕Бр╣Зр╕Ъ `key` р╣Др╕зр╣Йр╣Гр╕Щр╣Вр╕Др╣Йр╕Фр╣Вр╕Фр╕вр╕Хр╕гр╕З тЖТ р╣Ар╕Бр╣Зр╕Ър╣Гр╕Щр╣Др╕Яр╕ер╣М `.env`\
- р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ `expiresIn` р╣Гр╕лр╣Йр╣Ар╕лр╕бр╕▓р╕░р╕кр╕б р╣Ар╕Кр╣Ир╕Щ `'1h'`, `'7d'`\
- р╕нр╕вр╣Ир╕▓р╕Эр╕▒р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕ер╕▒р╕Ъ (р╣Ар╕Кр╣Ир╕Щ password) р╣Гр╕Щ payload\
- р╣Гр╕Кр╣Й `bcrypt.compare()` р╣Ар╕бр╕╖р╣Ир╕нр╕Хр╣Йр╕нр╕Зр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щр╕Бр╕▒р╕Ъ hash
